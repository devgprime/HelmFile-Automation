
# Allow external traffic to reach this service via a (cluster provided) ingress controller.
# https://wikitech.wikimedia.org/wiki/Kubernetes/Ingress#Configuration_(for_service_owners)
#
# TODO: In the future, we'd like to configure ingress to JobManager UI on the JobManager pods only.
#       See ideas for doing this here:
#       https://phabricator.wikimedia.org/T324576#8498319
#       For now, ingress is disabled.
#
aggregator_5g:
  ingress:
    enabled: true
    clustersuffix: apps.nsos-h4xv-cosp-dev3.nss.vzwnet.com
  metadata:
    name: ecds-pnw-carrierkpi-4g-killerue-screen-twelve-prod
    namespace: gulv-dev-aggregator  
  app:
    image: gulv-space-rtt-docker-np.oneartifactoryci.verizon.com/space-rtt-foa/rttflink:dev
    flinkConfiguration:
    #kubernetes.cluster-id: mni-carrieragg4g-alarms
      taskmanager.memory.managed.size: "2gb"
      taskmanager.memory.task.heap.size: "10gb"
      user.artifacts.base-dir: '/tmp'
      kubernetes.jobmanager.cpu: '0.2'
      kubernetes.jobmanager.cpu.limit-factor: '5.0'
      kubernetes.taskmanager.cpu: '1'
      kubernetes.taskmanager.cpu.limit-factor: '20'
      metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory
      rest.flamegraph.enabled: 'true'
      state.checkpoint-storage: 'filesystem'
      state.checkpoints.dir: 'file:///app/flink-data/checkpoints_dir'
      state.savepoints.dir: 'file:///app/flink-data/savepoints_dir'
      execution.checkpointing.unaligned: 'true'
      execution.checkpointing.min-pause: 2ms
      execution.checkpointing.interval: 1min
      web.cancel.enable: 'true'
      web.rescale.enable: 'true'

    podmonitor:  
      metadata:
        labels:
          app: ecds-pnw-carrierkpi-4g-killerue-screen-twelve-prod
        name: ecds-pnw-carrierkpi-4g-killerue-screen-twelve-prod
      matchnamespace:
        - gulv-dev-aggregator
      podMetricsEndpoints:
        - path: /metrics
          relabelings:
            - action: replace
              replacement: '$1:9249'
              sourceLabels:
                - __meta_kubernetes_pod_ip
              targetLabel: __address__
      selector:
        matchLabels:
          app: ecds-pnw-carrierkpi-4g-killerue-screen-twelve-prod

    pvc:        
      kind: PersistentVolumeClaim
      apiVersion: v1
      metadata:
        name: ecds-pnw-carrierkpi-4g-killerue-screen-twelve-prod
      accessModes:
        -  ReadWriteMany
      storage: 5Gi
      storageClassName: px-csi-repl2-delete
      volumeMode: Filesystem    


  debug:
    enabled: false # Not supported

ecds-pnw-carrierkpi-4g-stats-prod:
  ingress:
    enabled: true
    clustersuffix: apps.nsos-h4xv-cosp-dev3.nss.vzwnet.com
  metadata:
    name: ecds-pnw-carrierkpi-4g-stats-prod
    namespace: gulv-dev-aggregator  
  app:
    image: gulv-space-rtt-docker-np.oneartifactoryci.verizon.com/space-rtt-foa/rttflink
    version: dev

    flinkConfiguration:
    #kubernetes.cluster-id: mni-carrieragg4g-alarms
      taskmanager.numberOfTaskSlots: "1"
      heartbeat.timeout: "50000"
      kubernetes.jobmanager.cpu: '0.2'
      kubernetes.jobmanager.cpu.limit-factor: '4.0'
      kubernetes.taskmanager.cpu: '1'
      kubernetes.taskmanager.cpu.limit-factor: '6'
      metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory
      s3.endpoint: http://s3-nswest.nss.vzwnet.com
      s3.path.style.access: "true"
      
    job:
      parallelism: 20

    podmonitor:  
      metadata:
        name: ecds-pnw-carrierkpi-4g-stats-prod
        labels:
          app: ecds-pnw-carrierkpi-4g-stats-prod      
      matchnamespace:
        - gulv-dev-aggregator
      podMetricsEndpoints:
        - path: /metrics
          relabelings:
            - action: replace
              replacement: '$1:9249'
              sourceLabels:
                - __meta_kubernetes_pod_ip
              targetLabel: __address__
      selector:
        matchLabels:
          app: ecds-pnw-carrierkpi-4g-stats-prod



  debug:
    enabled: false # Not supported


aggregator_6g:
  ingress:
    enabled: true
    clustersuffix: apps.nsos-h4xv-cosp-dev3.nss.vzwnet.com
  metadata:
    name: ecds-carrieragg4g-region-prod
    namespace: gulv-dev-aggregator  
  app:
    image: gulv-space-rtt-docker-np.oneartifactoryci.verizon.com/space-rtt-foa/rttflink:f9ebf657
    flinkConfiguration:
    #kubernetes.cluster-id: mni-carrieragg4g-alarms
      taskmanager.numberOfTaskSlots: "10"
      heartbeat.timeout: "50000"
      kubernetes.jobmanager.cpu: '0.2'
      kubernetes.jobmanager.cpu.limit-factor: '5.0'
      kubernetes.taskmanager.cpu: '1'
      kubernetes.taskmanager.cpu.limit-factor: '20'
      metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory
      s3.endpoint: http://s3-nswest.nss.vzwnet.com
      s3.path.style.access: "true"

    podmonitor:  
      metadata:
        name: ecds-carrieragg4g-region-prod
        labels:
          app: ecds-carrieragg4g-region-prod      
      matchnamespace:
        - gulv-dev-aggregator
      podMetricsEndpoints:
        - path: /metrics
          relabelings:
            - action: replace
              replacement: '$1:9249'
              sourceLabels:
                - __meta_kubernetes_pod_ip
              targetLabel: __address__
      selector:
        matchLabels:
          app: ecds-carrieragg4g-region-prod



  debug:
    enabled: false # Not supported

    
aggregator_alarm:
  ingress:
    enabled: true
    clustersuffix: apps.nsos-h4xv-cosp-dev3.nss.vzwnet.com
  metadata:
    name: ecds-carrieragg4g-region-prod
    namespace: gulv-dev-aggregator  
  app:
    image: gulv-space-rtt-docker-np.oneartifactoryci.verizon.com/space-rtt-foa/rttflink:f9ebf657
    flinkConfiguration:
    #kubernetes.cluster-id: mni-carrieragg4g-alarms
      taskmanager.numberOfTaskSlots: "10"
      heartbeat.timeout: "50000"
      kubernetes.jobmanager.cpu: '0.2'
      kubernetes.jobmanager.cpu.limit-factor: '5.0'
      kubernetes.taskmanager.cpu: '1'
      kubernetes.taskmanager.cpu.limit-factor: '20'
      metrics.reporter.prom.factory.class: org.apache.flink.metrics.prometheus.PrometheusReporterFactory
      s3.endpoint: http://s3-nswest.nss.vzwnet.com
      s3.path.style.access: "true"

    podmonitor:  
      metadata:
        name: ecds-carrieragg4g-region-prod
        labels:
          app: ecds-carrieragg4g-region-prod      
      matchnamespace:
        - gulv-dev-aggregator
      podMetricsEndpoints:
        - path: /metrics
          relabelings:
            - action: replace
              replacement: '$1:9249'
              sourceLabels:
                - __meta_kubernetes_pod_ip
              targetLabel: __address__
      selector:
        matchLabels:
          app: ecds-carrieragg4g-region-prod
